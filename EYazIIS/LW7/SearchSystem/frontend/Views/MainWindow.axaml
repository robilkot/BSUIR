<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:frontend.ViewModels"
        x:Class="frontend.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="File Search" 
        Width="800" 
        Height="600"
        MinWidth="600"
        MinHeight="400"
        RequestedThemeVariant="Light">
    
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

  <Grid
    Margin="8 16 8 8"
    VerticalAlignment="Center"
    RowDefinitions="auto, *"
    RowSpacing="8">
    
    <!-- Search controls -->
    <StackPanel
      Grid.Row="0"
      Orientation="Vertical"
      Spacing="8">
    
      <StackPanel
        HorizontalAlignment="Center"
        Orientation="Horizontal">
        <Grid>
          <TextBox
            Width="450"
            Name="SearchTextBox"
            Padding="12 0"
            CornerRadius="20 0 0 20"
            VerticalAlignment="Stretch"
            VerticalContentAlignment="Center"
            Watermark="Что вы хотите найти?"
            FontSize="16"
            KeyDown="OnSearchKeyDown"
            Text="{Binding SearchQuery}">
          </TextBox>
          <Button
            Margin="1"
            Width="35"
            CornerRadius="0"
            Command="{Binding ClearSearchCommand}"
            HorizontalAlignment="Right">
            <PathIcon
              Height="16"
              Data="{StaticResource dismiss_circle_regular}"/>
          </Button>
        </Grid>

        <Border
          Name="SearchOptionsBorder"
          BorderBrush="LightGray"
          CornerRadius="0 20 20 0"
          BorderThickness="0 1 1 1">
          <StackPanel
            Orientation="Horizontal">
            <Button
              Width="35"
              Command="{Binding VoiceInputCommand}"
              CornerRadius="0">
              <PathIcon
                Height="16"
                Data="{StaticResource mic_on_regular}"/>
            </Button>
            <ToggleButton
              IsChecked="True"
              MinHeight="20"
              Name="OptionsToggle"
              Width="35"
              CornerRadius="0">
              <PathIcon
                Height="12"
                Data="{StaticResource options_regular}"/>
            </ToggleButton>
            <Button
              Padding="25 5"
              Margin="-1"
              Command="{Binding SearchCommand}"
              CornerRadius="{Binding #SearchOptionsBorder.CornerRadius}"
              Background="#4285F4">
              <PathIcon
                Height="16"
                Foreground="White"
                Data="{StaticResource search_regular}"/>
            </Button>
          </StackPanel>
        </Border>
      </StackPanel>
      
      <!-- Date Range Filter -->
      <StackPanel 
        IsVisible="{Binding #OptionsToggle.IsChecked}"
        Orientation="Horizontal"
        HorizontalAlignment="Center"
        Spacing="8">
        <TextBlock 
          Text="За период" 
          VerticalAlignment="Center"/>
        <CalendarDatePicker
          Watermark="от"
          SelectedDate="{Binding StartDate}"/>
        <CalendarDatePicker
          Watermark="до"
          SelectedDate="{Binding EndDate}"/>
      </StackPanel>

    </StackPanel>

    <Grid
      Grid.Row="1"
      IsVisible="{Binding HasResults}"
      RowDefinitions="*, auto">
      <!-- Results -->
      <ScrollViewer>
        <Grid
          RowDefinitions="*, auto">
          <ItemsControl
            ItemsSource="{Binding SearchResults}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border Padding="15" Margin="0,0,0,10" Background="#F8F9FA" CornerRadius="5">
                  <StackPanel Spacing="4">
                    <StackPanel
                      Orientation="Horizontal"
                      Spacing="8">
                      <HyperlinkButton
                        NavigateUri="{Binding Uri}"
                        FontWeight="Bold"
                        Padding="0"
                        FontSize="16">
                        <TextBlock Text="{Binding Title}" TextDecorations="{x:Null}"/>
                      </HyperlinkButton>
                      <TextBlock 
                        VerticalAlignment="Center"
                        Text="{Binding Relevance, StringFormat='{}{0:P0} relevance'}"
                        FontSize="12"
                        Foreground="#70757A"/>
                      <TextBlock 
                        VerticalAlignment="Center"
                        Text="{Binding IndexedAt, StringFormat='{}{0:dd/MM/yyyy}'}"
                        FontSize="12"
                        Foreground="#70757A"/>
                    </StackPanel>
                    <TextBlock 
                      Text="{Binding Snippet}"
                      TextWrapping="Wrap"
                      Foreground="#5F6368"/>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
          
          <!-- Pagination -->
          <StackPanel
            Grid.Row="1"
            Orientation="Horizontal"
            HorizontalAlignment="Center"
            Spacing="10"
            IsVisible="{Binding HasResults}">
            <Button Content="Next"
                    Command="{Binding NextPageCommand}"
                    IsEnabled="{Binding HasNextPage}"/>
          </StackPanel>
        </Grid>
      </ScrollViewer>
      
      <!-- Loading Indicator -->
      <ProgressBar
        Grid.RowSpan="2"
        IsIndeterminate="True"
        IsVisible="{Binding IsLoading}"
        Height="4"
        HorizontalAlignment="Center"
        VerticalAlignment="Center"/>

      <!-- No Results Message -->
      <TextBlock 
        Grid.RowSpan="2"
        Text="No results found"
        IsVisible="{Binding HasNoResults}"
        HorizontalAlignment="Center"
        VerticalAlignment="Center"
        FontSize="18"
        Foreground="#70757A"/>
    </Grid>
  </Grid>
</Window>